---
title: "Untitled"
author: "Daniel Fireman (danielfireman@gmail.com)"
date: "April 14, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
require(dplyr)
require(ggpubr)

colors <- c("yellowgreen", "violetred4")
cOn <- colors[1]
cOff <- colors[2]
```

```{r}
sim_raw_data <- cbind(
  rbind(
    data.frame(
      "n"=1,
      "pos"=1,  # where this tick is the x-axis
      "pcp"=c(0.231876,0.097039,0.051976,0.093941,0.045551,0.152682,0.107873,0.135808,0.083458,0.079348,0.116016,0.069067,0.105772,0.201415,0.172598,0.131679,0.139450,0.083581,0.053739,0.201057,0.059495,0.191902,0.061721,0.133258,0.080955,0.085603,0.073845,0.142468,0.140606,0.109979),
      "pvn"=c(0.231876,0.097039,0.051976,0.093941,0.045551,0.152682,0.107873,0.135808,0.083458,0.079348,0.116016,0.069067,0.105772,0.201415,0.172598,0.131679,0.139450,0.083581,0.053739,0.201057,0.059495,0.191902,0.061721,0.133258,0.080955,0.085603,0.073845,0.142468,0.140606,0.109979)
    ),
    data.frame(
      "n"=2,
      "pos"=2,  # where this tick is the x-axis
      "pcp"=c(0.084379,0.130879,0.094645,0.088449,0.102019,0.112788,0.108854,0.094220,0.077600,0.174837,0.081916,0.076286,0.152145,0.169938,0.080344,0.092575,0.108636,0.071429,0.114786,0.107051,0.071500,0.163362,0.063602,0.076499,0.083898,0.121497,0.093398,0.114043,0.144002,0.121083),
      "pvn"=c(0.002055,0.001449,0.011509,0.002199,0.010210,0.000000,0.007351,0.010867,0.000000,0.019363,0.002654,0.000000,0.006684,0.003646,0.002860,0.002351,0.002586,0.000000,0.003625,0.005784,0.002701,0.003498,0.003163,0.000277,0.000000,0.006762,0.001064,0.011734,0.000000,0.005259)
    ),
    data.frame(
      "n"=4,
      "pos"=3,  # where this tick is the x-axis
      "pcp"=c(0.092391,0.193141,0.119707,0.098379,0.114390,0.077782,0.097437,0.111713,0.126066,0.087241,0.106512,0.144235,0.090618,0.115772,0.112606,0.090728,0.082921,0.153324,0.100047,0.134142,0.130463,0.126058,0.094816,0.121627,0.093800,0.116010,0.093591,0.093362,0.088266,0.122434),
      "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    ),
    data.frame(
      "n"=8,
      "pos"=4,  # where this tick is the x-axis
      "pcp"=c(0.106640,0.073346,0.095361,0.108990,0.072893,0.086578,0.119264,0.128435,0.101627,0.077611,0.092562,0.157184,0.137102,0.109079,0.081296,0.098146,0.100282,0.092930,0.101492,0.082220,0.110279,0.107539,0.088428,0.082422,0.110261,0.145713,0.118209,0.107853,0.089944,0.087468),
      "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    ),
    data.frame(
      "n"=16,
      "pos"=5,  # where this tick is the x-axis
      "pcp"=c(0.103319,0.123211,0.113136,0.091618,0.135705,0.101827,0.087051,0.109805,0.105678,0.082081,0.127102,0.102680,0.147700,0.146275,0.084952,0.136772,0.110203,0.103380,0.113483,0.078660,0.143245,0.110044,0.109249,0.106189,0.112834,0.111903,0.112149,0.102767,0.119195,0.108217),
      "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    ),
    data.frame(
      "n"=32,
      "pos"=6,  # where this tick is the x-axis
      "pcp"=c(0.117237,0.104478,0.116770,0.125238,0.103064,0.117372,0.112753,0.106813,0.116171,0.096107,0.110529,0.105058,0.096938,0.105682,0.113032,0.105889,0.103905,0.104736,0.113424,0.099411,0.114476,0.111725,0.107001,0.129871,0.121596,0.125440,0.115871,0.117714,0.105921,0.097076),
      "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    ),
    data.frame(
      "n"=64,
      "pos"=7,  # where this tick is the x-axis
      "pcp"=c(0.103853,0.114059,0.097668,0.120891,0.096481,0.109546,0.096295,0.093613,0.105230,0.107814,0.118165,0.106514,0.109495,0.112432,0.103401,0.100735,0.109259,0.103617,0.107804,0.104433,0.101130,0.111578,0.100190,0.111132,0.107839,0.110891,0.112385,0.108346,0.093775,0.105230),
      "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    )
    # data.frame(
    #   "n"=128,
    #   "pcp"=c(0.106685,0.102807,0.117195,0.118513,0.102125,0.113406,0.104559,0.114742,0.105029,0.104557,0.104382,0.111214,0.113268,0.110601,0.103757,0.107612,0.109746,0.103013,0.111071,0.113226,0.110827,0.102471,0.105225,0.107719,0.108791,0.103792,0.106620,0.113838,0.107549,0.116823),
    #   "pvn"=c(0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000)
    # ),
  ),
  "modelo"="Simulado"
)

analytical <- data.frame(
  "n"=c(1,2,4,8,16,32,64),
  "pos"=c(1,2,3,4,5,6,7),
  "pcp"=c(0.097157,0.106840,0.107986,0.108000,0.10800,0.108000,0.108000),
  "pvn"=c(0.097157,0.010380, 0.000121,0.000000,0.000000,0.000000,0.000000),
  "modelo"="Analítico")


# Calculates mean, sd, se and IC
# Inspired by: https://www.r-graph-gallery.com/4-barplot-with-error-bar.html
#sim_raw_data <- cbind(rbind(sim_1, sim_2, sim_3, sim_4, sim_5),"modelo"="Simulado")
cmp_raw_data <- rbind(sim_raw_data, analytical)
cmp_data <- cmp_raw_data %>%
  group_by(n, pos, modelo) %>%
  summarise( 
    count=n(),
    pvn_mean=mean(pvn),
    pvn_sd=sd(pvn),
    pcp_mean=mean(pcp),
    pcp_sd=sd(pcp)
  ) %>%
  mutate(pvn_se=pvn_sd/sqrt(count))  %>%
  mutate(pvn_ic=pvn_se * qt((1-0.05)/2 + .5, count-1)) %>%
  mutate(pcp_se=pcp_sd/sqrt(count))  %>%
  mutate(pcp_ic=pcp_se * qt((1-0.05)/2 + .5, count-1))

# Graphing results
ggplot(cmp_data, aes(x=pos, y=pvn_mean, ymin=pvn_mean-pvn_ic, ymax=pvn_mean+pvn_ic)) +
  geom_col(aes(alpha=modelo), position=position_dodge2(preserve="single"), stat="identity", color="darkgrey", fill="yellowgreen") +
  geom_errorbar(position=position_dodge(), width=.5) +
  scale_y_continuous(limit=0:1, labels = function(x) paste0(x*100, "%")) +
  scale_x_discrete(labels=cmp_data$n, limits=cmp_data$pos) +  # renaming pos by n
  labs(
    x="Número de réplicas",
    y="PVN",
    alpha="Modelo") +
  theme_pubr() +
  theme(
    legend.position="bottom",
    panel.grid.major.x = element_line(colour = "darkgray", linetype = 3),
    panel.grid.minor.y = element_line(colour = "lightgray", linetype = 3, size=0.25),
    panel.grid.major.y = element_line(colour = "darkgray", linetype = 3))
ggsave("validation_pvn.png")

ggplot(cmp_data, aes(x=pos, y=pcp_mean, ymin=pcp_mean-pcp_ic, ymax=pcp_mean+pcp_ic)) +
  geom_col(aes(alpha=modelo), position=position_dodge2(preserve="single"), stat="identity", color="darkgrey", fill="yellowgreen") +
  geom_errorbar(position=position_dodge(), width=.5) +
  scale_y_continuous(limit=0:1, labels = function(x) paste0(x*100, "%")) +
  scale_x_discrete(labels=cmp_data$n, limits=cmp_data$pos) +  # renaming pos by n
  labs(
    x="Número de réplicas",
    y="PCP",
    alpha="Modelo") +
  theme_pubr() +
  theme(
    legend.position="bottom",
    panel.grid.major.x = element_line(colour = "darkgray", linetype = 3),
    panel.grid.minor.y = element_line(colour = "lightgray", linetype = 3, size=0.25),
    panel.grid.major.y = element_line(colour = "darkgray", linetype = 3))
ggsave("validation_pcp.png")
```



