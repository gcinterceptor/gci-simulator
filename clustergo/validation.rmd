---
title: "Untitled"
author: "Daniel Fireman (danielfireman@gmail.com)"
date: "April 14, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
require(dplyr)
```

```{r}

# Extract
# cat *.out | grep PCP | cut -d' ' -f1 | cut -d: -f2
# cat *.out | grep PVN | cut -d' ' -f1 | cut -d: -f2

# 1 replica
# Run: cd inputgen/; go run main.go --duration=3600000 --r=10 --mu=0.0036 --bigOmega=0.003 --littleOmega=0.0001; cd ..; for i in `seq 1 10`; do go run main.go --rate=1 --warmup=0 --d=1h --i=inputgen/input_$i.csv > r1_$i.out; done
# Pack output: zip sim_1_out.zip r1_*.out

sim_1 <- data.frame("n"=1, "pcp"=c(0.087828,0.100554,0.122147,0.091038,0.099548,0.102508,0.101182,0.098226,0.091749,0.110540,0.082539,0.084199,0.097930,0.103615,0.082634,0.075048,0.099349,0.091276,0.103073,0.097636,0.102800,0.087523,0.114552,0.100970,0.105609,0.098608,0.109040,0.093157,0.119403,0.099156,0.075839,0.094279,0.077695,0.096843,0.087811,0.103664,0.097543,0.101913,0.114679,0.081196,0.120413,0.091432,0.091970,0.083556,0.091861,0.132718,0.092036,0.087000,0.112325,0.100490), "pvn"=c(0.096868, 0.116235, 0.084960, 0.110168, 0.130572, 0.132739, 0.070176, 0.093550, 0.091497, 0.085696))

# 2 replicas
# Run: cd clustergo; for i in `seq 1 10`; do cd inputgen/; go run main.go --duration=3600000 --r=2 --mu=0.0036 --bigOmega=0.003 --littleOmega=0.0001; cd ..;  go run main.go --rate=1 --warmup=0 --d=1h --i=inputgen/input_1.csv,inputgen/input_2.csv > r2_$i.out; rm inputgen/input_*.csv; done
# Pack output: zip sim_2_out.zip r2_*.out; rm *.out

sim_2 <- data.frame("n"=2, "pcp"=c(0.103967,0.089648,0.113708,0.084848,0.078597,0.098332,0.137233,0.072529,0.106390,0.089083,0.074353,0.110095,0.096170,0.071154,0.083234,0.077419,0.104308,0.089559,0.123605,0.077239,0.120112,0.102607,0.095481,0.094122,0.085818,0.116828,0.081776,0.106396,0.110923,0.092733,0.107282,0.071275,0.095274,0.095999,0.076614,0.099532,0.096317,0.101180,0.113841,0.091892,0.091085,0.093966,0.086518,0.066064,0.094390,0.091578,0.085647,0.080538,0.094753,0.070735), "pvn"=c(0.004891,0.003876,0.008996,0.001429,0.006466,0.004020,0.011546,0.002198,0.003598,0.001286,0.004288,0.010889,0.004433,0.001628,0.002104,0.004995,0.005269,0.001762,0.002564,0.003522,0.011380,0.002592,0.003929,0.006072,0.003638,0.012467,0.003614,0.008944,0.006296,0.002932,0.003405,0.003124,0.002313,0.000044,0.004821,0.005040,0.004700,0.008588,0.006201,0.005290,0.003896,0.004797,0.003823,0.002525,0.005128,0.004599,0.003808,0.003739,0.004910,0.001141))

# 3 replicas
# Run: for i in `seq 1 10`; do cd inputgen/; go run main.go --duration=3600000 --r=3 --mu=0.0036 --bigOmega=0.003 --littleOmega=0.0001; cd ..;  go run main.go --rate=1 --warmup=0 --d=1h --i=inputgen/input_1.csv,inputgen/input_2.csv,inputgen/input_3.csv > r3_$i.out; rm inputgen/input_*.csv; done
# Pack output: zip sim_3_out.zip r3_*.out; rm *.out

sim_3 <- data.frame("n"=3, "pcp"=c(0.076665, 0.099287, 0.084492, 0.081343, 0.095050, 0.087707, 0.091867, 0.071911, 0.090259, 0.081107), "pvn"=c(0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000))

# 4 Replicas
# Run: for i in `seq 1 10`; do cd inputgen/; go run main.go --duration=3600000 --r=4 --mu=0.0036 --bigOmega=0.003 --littleOmega=0.0001; cd ..;  go run main.go --rate=1 --warmup=0 --d=1h --i=inputgen/input_1.csv,inputgen/input_2.csv,inputgen/input_3.csv,inputgen/input_4.csv > r4_$i.out; rm inputgen/input_*.csv; done
# Pack output: zip sim_4_out.zip r4_*.out; rm *.out

sim_4 <- data.frame("n"=4, "pcp"=c(0.089460, 0.086109, 0.079032, 0.073925, 0.089927, 0.093196, 0.087492, 0.072702, 0.077475, 0.071132), "pvn"=c(0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000))

# 5 Replicas
# Run: for i in `seq 1 10`; do cd inputgen/; go run main.go --duration=3600000 --r=5 --mu=0.0036 --bigOmega=0.003 --littleOmega=0.0001; cd ..;  go run main.go --rate=1 --warmup=0 --d=1h --i=inputgen/input_1.csv,inputgen/input_2.csv,inputgen/input_3.csv,inputgen/input_4.csv,inputgen/input_5.csv > r5_$i.out; rm inputgen/input_*.csv; done
# Pack output: zip sim_5_out.zip r5_*.out; rm *.out

sim_5 <- data.frame("n"=5, "pcp"=c(0.098370, 0.076470, 0.080757, 0.094711, 0.080790, 0.091174, 0.070913, 0.078000, 0.071904, 0.084757), "pvn"=c(0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000))

analytical <- data.frame("n"=c(1,2,3,4,5), "pvn"=c(0.097157, 0.010380, 0.001120, 0.000121, 0.000013), "pcp"=c(0.097157, 0.106840, 0.107875, 0.107986, 0.107999), "modelo"="AnalÃ­tico")
  

# Calculates mean, sd, se and IC
# Inspired by: https://www.r-graph-gallery.com/4-barplot-with-error-bar.html
sim_raw_data <- cbind(rbind(sim_1, sim_2, sim_3, sim_4, sim_5),"modelo"="Simulado")
sim_data <- sim_raw_data %>%
  group_by(n) %>%
  summarise( 
    count=n(),
    pvn_mean=mean(pvn),
    pvn_sd=sd(pvn),
    pcp_mean=mean(pcp),
    pcp_sd=sd(pcp)
  ) %>%
  mutate(pvn_se=pvn_sd/sqrt(count))  %>%
  mutate(pvn_ic=pvn_se * qt((1-0.05)/2 + .5, count-1)) %>%
  mutate(pcp_se=pcp_sd/sqrt(count))  %>%
  mutate(pcp_ic=pcp_se * qt((1-0.05)/2 + .5, count-1))

mean(sim_2$pvn)
analytical$pvn

ggplot(sim_data) +
  geom_point(aes(x=n, y=pvn_mean), stat="identity", fill="forestgreen", alpha=0.5) +
  geom_point(data=analytical, aes(x=n, y=pvn), stat="identity", fill="forestgreen", alpha=0.5, color="red") +
  geom_errorbar(aes(x=n, ymin=pvn_mean-pvn_ic, ymax=pvn_mean+pvn_ic), width=0.4, colour="orange", alpha=0.9, size=1.5) +
  ggtitle("PVN using confidence interval")

ggplot(sim_data) +
  geom_point(aes(x=n, y=pcp_mean), stat="identity", fill="forestgreen", alpha=0.5) +
  geom_point(data=analytical, aes(x=n, y=pcp), stat="identity", fill="forestgreen", alpha=0.5, color="red") +
  geom_errorbar(aes(x=n, ymin=pcp_mean-pcp_ic, ymax=pcp_mean+pcp_ic), width=0.4, colour="orange", alpha=0.9, size=1.5) +
  ggtitle("PCP using confidence interval")
```



